<?php
/*
 Êú¨‰ª£Á†ÅÁî± Áà±ÂèëËµÑÊ∫êÁΩëÁã¨ÂÆ∂ÂàõÂª∫
 ÂàõÂª∫Êó∂Èó¥ 2020-10-31 12:30:45
 ÊäÄÊúØÊîØÊåÅ ÂßùÂ¶çËÆ°ÁÆóÊú∫
 ÂÆòÊñπÁΩëÂùÄ http://www.a8tg.com
 ÂÆ¢ÊúçQQ-351075088 QQ-244656508
 Ë¥≠‰π∞ÊéàÊùÉËØ∑Âà∞ÂÆòÊñπËøõË°åË¥≠‰π∞ÊàñËÄÖËÅîÁ≥ªÂÆòÊñπÊåáÂÆö‰ª£ÁêÜ‰∫∫ÂëòËøõË°åË¥≠‰π∞
*/

namespace app\index\controller;use app\common\model\Channel as ChannelModel;use app\common\model\Goods;use app\common\model\Goods as GoodsModel;use app\common\model\GoodsCoupon as CouponModel;use app\common\model\Order as OrderModel;use app\common\model\User as UserModel;use app\common\Pay as PayAPI;use app\common\util\notify\Stock;use think\Db;use think\Request;class Pay extends Base{public function __construct(){parent::__construct();}public function auth(){unset($K4ktIA0);$K4ktIA0=input('trade_no/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx2;goto K4kldMhx2;K4keWjgx2:return '‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ';goto K4kx1;K4kldMhx2:K4kx1:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgx4;goto K4kldMhx4;K4keWjgx4:return 'ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ';goto K4kx3;K4kldMhx4:K4kx3:$K4kzAvP0=array();$K4kzAvP0['id']=$order['channel_id'];$K4kzAvP0['status']=1;unset($K4ktIA0);$K4ktIA0=ChannelModel::get($K4kzAvP0);$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgx6;goto K4kldMhx6;K4keWjgx6:return 'ËØ•ÊîØ‰ªò‰∫ßÂìÅÊ≤°ÊúâÂèØÁî®ÁöÑÊîØ‰ªòÊ∏†ÈÅìÔºÅ';goto K4kx5;K4kldMhx6:K4kx5:$K4klFkgHhx7=$channel['code'];$K4kA0=$K4klFkgHhx7=='pafbWxGzh';if($K4kA0)goto K4keWjgxj;goto K4kldMhxj;K4keWjgxj:goto K4kcgFhx8;goto K4kxi;K4kldMhxj:K4kxi:$K4kA0=$K4klFkgHhx7=='Wsyh';if($K4kA0)goto K4keWjgxh;goto K4kldMhxh;K4keWjgxh:goto K4kcgFhx9;goto K4kxg;K4kldMhxh:K4kxg:goto K4kx7;K4kcgFhx8:K4kcgFhx9:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxb;goto K4kldMhxb;K4keWjgxb:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kxa;K4kldMhxb:K4kxa:unset($K4ktIA0);$K4ktIA0=input('open_id/s');$openid=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('sub_open_id/s');$subOpenid=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $order->trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->realOrder($openid,$subOpenid,$order->trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgxd;goto K4kldMhxd;K4keWjgxd:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);die($K4khC0);goto K4kxc;K4kldMhxd:K4kxc:$K4kA0=$channel['code']=='Wsyh';if($K4kA0)goto K4keWjgxf;goto K4kldMhxf;K4keWjgxf:goto K4kxe;K4kldMhxf:K4kxe:$this->assign('json',$res->pay_url);$K4kzAvPvP1=array();$K4kzAvPvP1['orderid']=$order->trade_no;$this->assign('url',url('/orderquery',$K4kzAvPvP1));$K4kzA1=array();$K4kzA1[]='wx_native';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx7;K4kx7:}public function payment(){unset($K4ktIA0);$K4ktIA0=session('token');$token=$K4ktIA0;$K4kA0=!$token;if($K4kA0)goto K4keWjgxl;goto K4kldMhxl;K4keWjgxl:$ìÃØÚùê·="time";$K4keFvP0=$ìÃØÚùê·();$Éï€Ö™éø="time";$K4keFvPvP1=$Éï€Ö™éø();$êàú≈åä◊="md5";$K4keFvP2=$êàú≈åä◊($K4keFvPvP1);$K4kvPA0=$K4keFvP0 . $K4keFvP2;$Ì†æ¸»…Ω="time";$K4keFvP3=$Ì†æ¸»…Ω();$K4kvPA1=$K4kvPA0 . $K4keFvP3;$¥¨¶≠ÍîÌ="md5";$K4keF4=$¥¨¶≠ÍîÌ($K4kvPA1);$Û⁄ôÅ˙≠ã="time";$K4keF5=$Û⁄ôÅ˙≠ã();$K4kA2=$K4keF4 . $K4keF5;unset($K4ktIA3);$K4ktIA3=$K4kA2;$token=$K4ktIA3;session('token',$token);goto K4kxk;K4kldMhxl:K4kxk:$K4kzA1=array();$K4kzA1[]='token';$K4kzA1[]=&$token;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=input('trade_no/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgxn;goto K4kldMhxn;K4keWjgxn:return '‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ';goto K4kxm;K4kldMhxn:K4kxm:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxp;goto K4kldMhxp;K4keWjgxp:return 'ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ';goto K4kxo;K4kldMhxp:K4kxo:unset($K4ktIA0);$K4ktIA0=$order['trade_no'];$trade_no=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$order['total_price'];$money=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$order['channel_id'];$type=$K4ktIA0;$K4kA0="?order=" . $trade_no;$K4kA1=$K4kA0 . "&money=";$K4kA2=$K4kA1 . $money;$K4kA3=$K4kA2 . "&type=";$K4kA4=$K4kA3 . $type;unset($K4ktIA5);$K4ktIA5=$K4kA4;$str=$K4ktIA5;$K4kA0=$type=='71';$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgxs;goto K4kldMhxs;K4keWjgxs:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="ismobile";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kA1=$K4khC0=='1';$K4kA2=(bool)$K4kA1;goto K4kxr;K4kldMhxs:K4kxr:if($K4kA2)goto K4keWjgxt;goto K4kldMhxt;K4keWjgxt:$K4kvPA0="Location:/pay/pay.php" . $str;$ñüπ®ñ±Á="header";$K4keF0=$ñüπ®ñ±Á($K4kvPA0);die();goto K4kxq;K4kldMhxt:K4kxq:$K4kA0=$type=='77';$K4kA2=(bool)$K4kA0;$K4kA9=!$K4kA2;if($K4kA9)goto K4keWjgx11;goto K4kldMhx11;K4keWjgx11:$K4kA1=$type=='78';$K4kA2=(bool)$K4kA1;goto K4kxz;K4kldMhx11:K4kxz:$K4kA4=(bool)$K4kA2;$K4kA8=!$K4kA4;if($K4kA8)goto K4keWjgxy;goto K4kldMhxy;K4keWjgxy:$K4kA3=$type=='79';$K4kA4=(bool)$K4kA3;goto K4kxx;K4kldMhxy:K4kxx:$K4kA6=(bool)$K4kA4;$K4kA7=!$K4kA6;if($K4kA7)goto K4keWjgxw;goto K4kldMhxw;K4keWjgxw:$K4kA5=$type=='80';$K4kA6=(bool)$K4kA5;goto K4kxv;K4kldMhxw:K4kxv:if($K4kA6)goto K4keWjgx12;goto K4kldMhx12;K4keWjgx12:$K4kvPA0="Location:/pay/wmpay.php" . $str;$˝ÖÆ∏ﬁò˙="header";$K4keF0=$˝ÖÆ∏ﬁò˙($K4kvPA0);die();goto K4kxu;K4kldMhx12:K4kxu:$K4kA0=$type=='167';$K4kA2=(bool)$K4kA0;$K4kA3=!$K4kA2;if($K4kA3)goto K4keWjgx15;goto K4kldMhx15;K4keWjgx15:$K4kA1=$type=='170';$K4kA2=(bool)$K4kA1;goto K4kx14;K4kldMhx15:K4kx14:if($K4kA2)goto K4keWjgx16;goto K4kldMhx16;K4keWjgx16:$K4kvPA0="Location:/pay/jhpay.php" . $str;$⁄ˆÁ◊˙ì¬="header";$K4keF0=$⁄ˆÁ◊˙ì¬($K4kvPA0);die();goto K4kx13;K4kldMhx16:K4kx13:$K4kzAvP0=array();$K4kzAvP0['id']=$order['channel_id'];$K4kzAvP0['status']=1;unset($K4ktIA0);$K4ktIA0=ChannelModel::get($K4kzAvP0);$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgx18;goto K4kldMhx18;K4keWjgx18:return 'ËØ•ÊîØ‰ªò‰∫ßÂìÅÊ≤°ÊúâÂèØÁî®ÁöÑÊîØ‰ªòÊ∏†ÈÅìÔºÅ';goto K4kx17;K4kldMhx18:K4kx17:$K4klFkgHhx19=$order->pay_content_type;$K4kA0=$K4klFkgHhx19==2;if($K4kA0)goto K4keWjgx2y;goto K4kldMhx2y;K4keWjgx2y:goto K4kcgFhx1a;goto K4kx2x;K4kldMhx2y:K4kx2x:$K4kA0=$K4klFkgHhx19==3;if($K4kA0)goto K4keWjgx2w;goto K4kldMhx2w;K4keWjgx2w:goto K4kcgFhx2a;goto K4kx2v;K4kldMhx2w:K4kx2v:$K4kA0=$K4klFkgHhx19==4;if($K4kA0)goto K4keWjgx2u;goto K4kldMhx2u;K4keWjgx2u:goto K4kcgFhx2h;goto K4kx2t;K4kldMhx2u:K4kx2t:$K4kA0=$K4klFkgHhx19==5;if($K4kA0)goto K4keWjgx2s;goto K4kldMhx2s;K4keWjgx2s:goto K4kcgFhx2k;goto K4kx2r;K4kldMhx2s:K4kx2r:$K4kA0=$K4klFkgHhx19==6;if($K4kA0)goto K4keWjgx2q;goto K4kldMhx2q;K4keWjgx2q:goto K4kcgFhx2l;goto K4kx2p;K4kldMhx2q:K4kx2p:$K4kA0=$K4klFkgHhx19==7;if($K4kA0)goto K4keWjgx2o;goto K4kldMhx2o;K4keWjgx2o:goto K4kcgFhx2m;goto K4kx2n;K4kldMhx2o:K4kx2n:goto K4kx19;K4kcgFhx1a:$K4kzAvP1=array();$K4kzAvP1[]='64';$K4kzAvP1[]='54';$K4kzAvP1[]='98';if(in_array($order->paytype,$K4kzAvP1))goto K4keWjgx1c;goto K4kldMhx1c;K4keWjgx1c:$K4kA0=(bool)isset($_SERVER['HTTP_USER_AGENT']);if($K4kA0)goto K4keWjgx1f;goto K4kldMhx1f;K4keWjgx1f:unset($K4ktIA1);$K4ktIA1="strpos";$ÂùÎö“üÆ=$K4ktIA1;$K4keF1=$ÂùÎö“üÆ($_SERVER['HTTP_USER_AGENT'],'MicroMessenger');$K4kA0=(bool)$K4keF1;goto K4kx1e;K4kldMhx1f:K4kx1e:if($K4kA0)goto K4keWjgx1g;goto K4kldMhx1g;K4keWjgx1g:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgx1i;goto K4kldMhx1i;K4keWjgx1i:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kx1h;K4kldMhx1i:K4kx1h:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $order->trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($order->trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgx1k;goto K4kldMhx1k;K4keWjgx1k:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);die($K4khC0);goto K4kx1j;K4kldMhx1k:K4kx1j:$K4kA0=$order->paytype=='98';if($K4kA0)goto K4keWjgx1m;goto K4kldMhx1m;K4keWjgx1m:$K4kA0=$res->content_type==2;if($K4kA0)goto K4keWjgx1o;goto K4kldMhx1o;K4keWjgx1o:$K4kvPA0='location:' . $res->pay_url;header($K4kvPA0);exit();goto K4kx1n;K4kldMhx1o:K4kx1n:goto K4kx1l;K4kldMhx1m:K4kx1l:$this->assign('json',$res->pay_url);$K4kzAvPvP1=array();$K4kzAvPvP1['orderid']=$order->trade_no;$this->assign('url',url('/orderquery',$K4kzAvPvP1));$K4kzA1=array();$K4kzA1[]='wx_native';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx1d;K4kldMhx1g:K4kx1d:goto K4kx1b;K4kldMhx1c:K4kx1b:$K4kA0=$order->paytype==112;if($K4kA0)goto K4keWjgx1q;goto K4kldMhx1q;K4keWjgx1q:$K4kA0=(bool)isset($_SERVER['HTTP_USER_AGENT']);if($K4kA0)goto K4keWjgx1t;goto K4kldMhx1t;K4keWjgx1t:unset($K4ktIA1);$K4ktIA1="strpos";$õ°ﬂà€ñ˙=$K4ktIA1;$K4keF1=$õ°ﬂà€ñ˙($_SERVER['HTTP_USER_AGENT'],'MicroMessenger');$K4kA0=(bool)$K4keF1;goto K4kx1s;K4kldMhx1t:K4kx1s:if($K4kA0)goto K4keWjgx1u;goto K4kldMhx1u;K4keWjgx1u:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgx1w;goto K4kldMhx1w;K4keWjgx1w:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kx1v;K4kldMhx1w:K4kx1v:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $order->trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($order->trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgx1y;goto K4kldMhx1y;K4keWjgx1y:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);die($K4khC0);goto K4kx1x;K4kldMhx1y:K4kx1x:unset($K4ktIA0);$K4ktIA0=$res->pay_url;$order->pay_url=$K4ktIA0;return htmlspecialchars_decode($order->pay_url);goto K4kx1r;K4kldMhx1u:K4kx1r:goto K4kx1p;K4kldMhx1q:K4kx1p:$K4kA0=$order->paytype==67;if($K4kA0)goto K4keWjgx21;goto K4kldMhx21;K4keWjgx21:$K4kA0=(bool)isset($_SERVER['HTTP_USER_AGENT']);if($K4kA0)goto K4keWjgx24;goto K4kldMhx24;K4keWjgx24:unset($K4ktIA1);$K4ktIA1="strpos";$È±Ω∞„õõ=$K4ktIA1;$K4keF1=$È±Ω∞„õõ($_SERVER['HTTP_USER_AGENT'],'MicroMessenger');$K4kA0=(bool)$K4keF1;goto K4kx23;K4kldMhx24:K4kx23:if($K4kA0)goto K4keWjgx25;goto K4kldMhx25;K4keWjgx25:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgx27;goto K4kldMhx27;K4keWjgx27:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kx26;K4kldMhx27:K4kx26:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $order->trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($order->trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgx29;goto K4kldMhx29;K4keWjgx29:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);die($K4khC0);goto K4kx28;K4kldMhx29:K4kx28:$K4kvPA0='location:' . $res->pay_url;header($K4kvPA0);exit();goto K4kx22;K4kldMhx25:K4kx22:goto K4kx2z;K4kldMhx21:K4kx2z:$K4kvPA0='location:' . $order->pay_url;header($K4kvPA0);exit();goto K4kx19;K4kcgFhx2a:$K4kA0=$order->paytype==59;if($K4kA0)goto K4keWjgx2c;goto K4kldMhx2c;K4keWjgx2c:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgx2e;goto K4kldMhx2e;K4keWjgx2e:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kx2d;K4kldMhx2e:K4kx2d:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $order->trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($order->trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgx2g;goto K4kldMhx2g;K4keWjgx2g:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);die($K4khC0);goto K4kx2f;K4kldMhx2g:K4kx2f:unset($K4ktIA0);$K4ktIA0=$res->pay_url;$order->pay_url=$K4ktIA0;goto K4kx2b;K4kldMhx2c:K4kx2b:return htmlspecialchars_decode($order->pay_url);goto K4kx19;K4kcgFhx2h:if($this->request->isMobile())goto K4keWjgx2j;goto K4kldMhx2j;K4keWjgx2j:$K4kvPA0='location:' . $order->pay_url;header($K4kvPA0);exit();goto K4kx2i;K4kldMhx2j:K4kx2i:goto K4kx19;K4kcgFhx2k:$this->assign('json',$order->pay_url);$K4kzAvPvP1=array();$K4kzAvPvP1['orderid']=$order->trade_no;$this->assign('url',url('/orderquery',$K4kzAvPvP1));$K4kzA1=array();$K4kzA1[]='wx_native';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx19;K4kcgFhx2l:$this->assign('jump',$order->pay_url);$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='ycsh_qqwap';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx19;K4kcgFhx2m:$K4kA0=url('index/pay/wx_jspay_page') . '?trade_no=';$K4kA1=$K4kA0 . $order->trade_no;$K4kA2=$K4kA1 . '&url=';$K4kvPA3=Request::instance()->domain() . '/index/pay/submit_order_form?trade_no=';$K4kvPA4=$K4kvPA3 . $order->trade_no;$K4kA5=$K4kA2 . base64_encode($K4kvPA4);unset($K4ktIA6);$K4ktIA6=$K4kA5;$url=$K4ktIA6;$K4kvPA0='location:' . $url;$‡ï›ÌµœÆ="header";$K4keF0=$‡ï›ÌµœÆ($K4kvPA0);exit();goto K4kx19;K4kx19:$K4kA0=$channel['code']=='QPayAli';$K4kA2=(bool)$K4kA0;$K4kA3=!$K4kA2;if($K4kA3)goto K4keWjgx32;goto K4kldMhx32;K4keWjgx32:$K4kA1=$channel['code']=='QPayWx';$K4kA2=(bool)$K4kA1;goto K4kx31;K4kldMhx32:K4kx31:if($K4kA2)goto K4keWjgx33;goto K4kldMhx33;K4keWjgx33:unset($K4ktIA0);$K4ktIA0=1;$is_qpay=$K4ktIA0;goto K4kx3z;K4kldMhx33:unset($K4ktIA0);$K4ktIA0=0;$is_qpay=$K4ktIA0;K4kx3z:$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='is_qpay';$K4kzA1[]=&$is_qpay;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;}public function getOrderStatus(){unset($K4ktIA0);$K4ktIA0=input('token/s','');$token=$K4ktIA0;$K4kA0=$token!=session('token');if($K4kA0)goto K4keWjgx35;goto K4kldMhx35;K4keWjgx35:$K4kzAvP0=array();$K4kzAvP0['msg']='ÈùûÊ≥ïËØ∑Ê±Ç';return json($K4kzAvP0);goto K4kx34;K4kldMhx35:K4kx34:unset($K4ktIA0);$K4ktIA0=input('orderid/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx37;goto K4kldMhx37;K4keWjgx37:return '‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ';goto K4kx36;K4kldMhx37:K4kx36:return $order->status;}public function order(){unset($K4ktIA0);$K4ktIA0=session('token');$token=$K4ktIA0;$K4kA0=!$token;if($K4kA0)goto K4keWjgx39;goto K4kldMhx39;K4keWjgx39:$†⁄ÃÜ…Ïã="time";$K4keFvP0=$†⁄ÃÜ…Ïã();$ï‚Ì¬‘áÒ="time";$K4keFvPvP1=$ï‚Ì¬‘áÒ();$á∫‚Ÿ¯Öæ="md5";$K4keFvP2=$á∫‚Ÿ¯Öæ($K4keFvPvP1);$K4kvPA0=$K4keFvP0 . $K4keFvP2;$π®≥£÷Üñ="time";$K4keFvP3=$π®≥£÷Üñ();$K4kvPA1=$K4kvPA0 . $K4keFvP3;$¨œÖ¸ÁÿŒ="md5";$K4keF4=$¨œÖ¸ÁÿŒ($K4kvPA1);$ìÏü¢¬˜À="time";$K4keF5=$ìÏü¢¬˜À();$K4kA2=$K4keF4 . $K4keF5;unset($K4ktIA3);$K4ktIA3=$K4kA2;$token=$K4ktIA3;session('token',$token);goto K4kx38;K4kldMhx39:K4kx38:$K4kzA1=array();$K4kzA1[]='token';$K4kzA1[]=&$token;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=input('contact/s','');$data['contact']=$K4ktIA0;if(empty($data['contact']))goto K4keWjgx3b;goto K4kldMhx3b;K4keWjgx3b:return 'ËØ∑Â°´ÂÜôËÅîÁ≥ªÊñπÂºèÔºÅ';goto K4kx3a;K4kldMhx3b:K4kx3a:$K4kzAvP1=array();$K4kzAvP1['create_ip']=$this->request->ip();$K4kzAvP1['status']=0;unset($K4ktIA0);$K4ktIA0=Db::name('order')->where($K4kzAvP1)->whereTime('create_at','today')->count('id');$checkips=$K4ktIA0;$K4kA0=$checkips>sysconf('ip_buyfail_limit');if($K4kA0)goto K4keWjgx3d;goto K4kldMhx3d;K4keWjgx3d:return 'Ê£ÄÊµãÂà∞ÊÇ®ÁöÑË°å‰∏∫ÂºÇÂ∏∏ÔºåÊó†Ê≥ï‰∏ãÂçïÔºÅ';goto K4kx3c;K4kldMhx3d:K4kx3c:unset($K4ktIA0);$K4ktIA0=input('pwdforsearch2/s','');$qukamima=$K4ktIA0;$À“¿ßΩï⁄="strlen";$K4keF0=$À“¿ßΩï⁄($qukamima);$K4kA0=$K4keF0>1;if($K4kA0)goto K4keWjgx3f;goto K4kldMhx3f;K4keWjgx3f:$◊…µ»≈Å∞="strlen";$K4keF0=$◊…µ»≈Å∞($qukamima);$K4kA0=$K4keF0>20;$K4kA2=(bool)$K4kA0;$K4kA3=!$K4kA2;if($K4kA3)goto K4keWjgx3i;goto K4kldMhx3i;K4keWjgx3i:unset($K4ktIA4);$K4ktIA4="strlen";$úû§‚«Ô»=$K4ktIA4;$K4keF1=$úû§‚«Ô»($qukamima);$K4kA1=$K4keF1<6;$K4kA2=(bool)$K4kA1;goto K4kx3h;K4kldMhx3i:K4kx3h:if($K4kA2)goto K4keWjgx3j;goto K4kldMhx3j;K4keWjgx3j:return 'ËØ∑Â°´ÂÜôÂèñÂç°ÂØÜÁ†Å6-12‰Ωç‰πãÈó¥ÔºÅ';goto K4kx3g;K4kldMhx3j:K4kx3g:goto K4kx3e;K4kldMhx3f:K4kx3e:$K4kzAvP1=array();$K4kzAvP1['id']=input('userid/d',0);$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=UserModel::get($K4kzAvP1);$user=$K4ktIA0;$K4kA0=!$user;if($K4kA0)goto K4keWjgx3l;goto K4kldMhx3l;K4keWjgx3l:return '‰∏çÂ≠òÂú®ËØ•ÂïÜÂÆ∂ÔºÅ';goto K4kx3k;K4kldMhx3l:K4kx3k:unset($K4ktIA0);$K4ktIA0=$user->id;$data['user_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=generate_trade_no('T',$data['user_id']);$data['trade_no']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$_SERVER['REQUEST_TIME'];$data['create_at']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$this->request->ip();$data['create_ip']=$K4ktIA0;$K4kzAvP2=array();$K4kzAvP2['id']=input('goodid/d',0);$K4kzAvP2['user_id']=$user->id;$K4kzAvP2['status']=1;unset($K4ktIA0);$K4ktIA0=GoodsModel::get($K4kzAvP2);$goods=$K4ktIA0;$K4kA0=!$goods;if($K4kA0)goto K4keWjgx3n;goto K4kldMhx3n;K4keWjgx3n:return '‰∏çÂ≠òÂú®ËØ•ÂïÜÂìÅÔºÅ';goto K4kx3m;K4kldMhx3n:K4kx3m:$K4kA0=$goods->is_proxy==1;if($K4kA0)goto K4keWjgx3p;goto K4kldMhx3p;K4keWjgx3p:$K4kzAvP1=array();$K4kzAvP1['id']=$goods->proxy_id;unset($K4ktIA0);$K4ktIA0=GoodsModel::get($K4kzAvP1)->user_id;$proxy_user_id=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$proxy_user_id;$data['proxy_user_id']=$K4ktIA0;goto K4kx3o;K4kldMhx3p:K4kx3o:unset($K4ktIA0);$K4ktIA0=$goods->is_proxy;$data['is_proxy']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->proxy_id;$data['proxy_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->id;$data['goods_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->name;$data['goods_name']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->price;$data['goods_price']=$K4ktIA0;$K4kA0=$data['is_proxy']==1;if($K4kA0)goto K4keWjgx3r;goto K4kldMhx3r;K4keWjgx3r:$K4kzAvP1=array();$K4kzAvP1['id']=$goods->proxy_id;$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=GoodsModel::get($K4kzAvP1);$proxy_goods=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$proxy_goods->proxy_price;$data['goods_cost_price']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$proxy_goods->cost_price;$data['proxy_goods_cost_price']=$K4ktIA0;goto K4kx3q;K4kldMhx3r:unset($K4ktIA0);$K4ktIA0=$goods->cost_price;$data['goods_cost_price']=$K4ktIA0;K4kx3q:unset($K4ktIA0);$K4ktIA0=input('quantity/d',0);$quantity=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$quantity;$data['quantity']=$K4ktIA0;$K4kA0=$goods->cards_stock_count<$quantity;if($K4kA0)goto K4keWjgx3t;goto K4kldMhx3t;K4keWjgx3t:return 'Â∫ìÂ≠ò‰∏çË∂≥ÔºÅ';goto K4kx3s;K4kldMhx3t:K4kx3s:$K4kA0=$goods->limit_quantity>$quantity;if($K4kA0)goto K4keWjgx3v;goto K4kldMhx3v;K4keWjgx3v:$K4kA0='Ëµ∑Â§üÊï∞Èáè‰∏çËÉΩÂ∞ë‰∫é' . $goods->limit_quantity;$K4kA1=$K4kA0 . 'Âº†';return $K4kA1;goto K4kx3u;K4kldMhx3v:K4kx3u:$K4kA0=$goods->wholesale_discount==1;if($K4kA0)goto K4keWjgx3x;goto K4kldMhx3x;K4keWjgx3x:$K4kzA1=array();$K4kzA1[]=&$goods;$K4kzA1[]=&$quantity;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="get_discount_price";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=$K4khC0;$data['goods_price']=$K4ktIA0;goto K4kx3w;K4kldMhx3x:K4kx3w:unset($K4ktIA0);$K4ktIA0=input('is_coupon/d','');$data['coupon_type']=$K4ktIA0;$K4kA0=$data['coupon_type']==1;if($K4kA0)goto K4keWjgx4z;goto K4kldMhx4z;K4keWjgx4z:unset($K4ktIA0);$K4ktIA0=input('cateid/d',0);$cate_id=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('couponcode/s','');$coupon_code=$K4ktIA0;$K4kzAvPvPvP1=array();$K4kzAvPvPvP1[]=0;$K4kzAvPvPvP1[]=$cate_id;$K4kzAvPvP2=array();$K4kzAvPvP2[]='in';$K4kzAvPvP2[]=$K4kzAvPvPvP1;$K4kzAvP3=array();$K4kzAvP3['user_id']=$user->id;$K4kzAvP3['cate_id']=$K4kzAvPvP2;$K4kzAvP3['code']=$coupon_code;unset($K4ktIA0);$K4ktIA0=CouponModel::get($K4kzAvP3);$coupon=$K4ktIA0;$K4kA0=!$coupon;$K4kA2=(bool)$K4kA0;$K4kA6=!$K4kA2;if($K4kA6)goto K4keWjgx45;goto K4kldMhx45;K4keWjgx45:$K4kA1=$coupon->status!=1;$K4kA2=(bool)$K4kA1;goto K4kx44;K4kldMhx45:K4kx44:$K4kA4=(bool)$K4kA2;$K4kA5=!$K4kA4;if($K4kA5)goto K4keWjgx43;goto K4kldMhx43;K4keWjgx43:$K4kA3=$coupon->expire_at<$_SERVER['REQUEST_TIME'];$K4kA4=(bool)$K4kA3;goto K4kx42;K4kldMhx43:K4kx42:if($K4kA4)goto K4keWjgx46;goto K4kldMhx46;K4keWjgx46:return '‰∏çÂ≠òÂú®ËØ•‰ºòÊÉ†Âà∏ÊàñÂ∑≤ËøáÊúüÔºÅ';goto K4kx41;K4kldMhx46:K4kx41:unset($K4ktIA0);$K4ktIA0=2;$coupon->status=$K4ktIA0;$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$coupon;$K4kzA2[]="save";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=$coupon->id;$data['coupon_id']=$K4ktIA0;$K4kA0=$coupon->type==100;if($K4kA0)goto K4keWjgx48;goto K4kldMhx48;K4keWjgx48:$K4kA0=$data['goods_price']*$data['quantity'];$K4kA1=$K4kA0*$coupon->amount;$K4kA2=$K4kA1/100;unset($K4ktIA3);$K4ktIA3=$K4kA2;$data['coupon_price']=$K4ktIA3;goto K4kx47;K4kldMhx48:unset($K4ktIA0);$K4ktIA0=$coupon->amount;$data['coupon_price']=$K4ktIA0;K4kx47:goto K4kx3y;K4kldMhx4z:unset($K4ktIA0);$K4ktIA0=0;$data['coupon_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=0;$data['coupon_price']=$K4ktIA0;K4kx3y:$K4kA0=(int)$goods->sold_notify;unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['sold_notify']=$K4ktIA1;$K4kA0=(int)$goods->take_card_type;unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['take_card_type']=$K4ktIA1;$K4kA0=$goods->take_card_type==0;if($K4kA0)goto K4keWjgx4a;goto K4kldMhx4a;K4keWjgx4a:unset($K4ktIA0);$K4ktIA0='';$data['take_card_password']=$K4ktIA0;goto K4kx49;K4kldMhx4a:$K4kA0=$goods->take_card_type==2;if($K4kA0)goto K4keWjgx4b;goto K4kldMhx4b;K4keWjgx4b:unset($K4ktIA0);$K4ktIA0=input('pwdforsearch2/s','');$data['take_card_password']=$K4ktIA0;goto K4kx49;K4kldMhx4b:unset($K4ktIA0);$K4ktIA0=input('pwdforsearch1/s','');$pwdforsearch1=$K4ktIA0;$K4kA0=$pwdforsearch1==='';if($K4kA0)goto K4keWjgx4d;goto K4kldMhx4d;K4keWjgx4d:return 'ËØ∑ËæìÂÖ•ÂèñÂç°ÂØÜÁ†Å';goto K4kx4c;K4kldMhx4d:K4kx4c:unset($K4ktIA0);$K4ktIA0=$pwdforsearch1;$data['take_card_password']=$K4ktIA0;K4kx49:unset($K4ktIA0);$K4ktIA0=input('isemail/d',0);$data['email_notify']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('email/s','');$data['email']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('is_rev_sms/d',0);$data['sms_notify']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->sms_payer;$data['sms_payer']=$K4ktIA0;$K4kA0=$data['sms_notify']==0;$K4kA2=(bool)$K4kA0;$K4kA3=!$K4kA2;if($K4kA3)goto K4keWjgx4g;goto K4kldMhx4g;K4keWjgx4g:$K4kA1=$data['sms_payer']==1;$K4kA2=(bool)$K4kA1;goto K4kx4f;K4kldMhx4g:K4kx4f:if($K4kA2)goto K4keWjgx4h;goto K4kldMhx4h;K4keWjgx4h:unset($K4ktIA0);$K4ktIA0=0;$data['sms_price']=$K4ktIA0;goto K4kx4e;K4kldMhx4h:unset($K4ktIA0);$K4ktIA0=get_sms_cost();$data['sms_price']=$K4ktIA0;K4kx4e:$K4kvPA0=$data['goods_price']*$data['quantity'];$K4kvPA1=$K4kvPA0-$data['coupon_price'];$ºÜ˜ãê‚ˆ="round";$K4keF0=$ºÜ˜ãê‚ˆ($K4kvPA1,2);unset($K4ktIA2);$K4ktIA2=$K4keF0;$data['total_product_price']=$K4ktIA2;$K4kA0=$data['total_product_price']+$data['sms_price'];unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['total_price']=$K4ktIA1;$K4kvPA0=$data['goods_cost_price']*$data['quantity'];$ÁâÁºΩπ‚="round";$K4keF0=$ÁâÁºΩπ‚($K4kvPA0,2);unset($K4ktIA1);$K4ktIA1=$K4keF0;$data['total_cost_price']=$K4ktIA1;$K4kzAvP1=array();$K4kzAvP1['id']=input('pid/d',0);$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=ChannelModel::get($K4kzAvP1);$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgx4j;goto K4kldMhx4j;K4keWjgx4j:return 'ËØ•ÊîØ‰ªò‰∫ßÂìÅÊ≤°ÊúâÂèØÁî®ÁöÑÊîØ‰ªòÊ∏†ÈÅìÔºÅ';goto K4kx4i;K4kldMhx4j:K4kx4i:unset($K4ktIA0);$K4ktIA0=Db::name('rate_group_user')->where('user_id',$user->id)->find();$rate_group_user=$K4ktIA0;$K4kA0=!empty($rate_group_user);if($K4kA0)goto K4keWjgx4l;goto K4kldMhx4l;K4keWjgx4l:$K4kzAvP1=array();$K4kzAvP1['group_id']=$rate_group_user['group_id'];$K4kzAvP1['channel_id']=$channel->id;$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=Db::name('rate_group_rule')->where($K4kzAvP1)->find();$rate_group_rule=$K4ktIA0;if(empty($rate_group_rule))goto K4keWjgx4n;goto K4kldMhx4n;K4keWjgx4n:$K4kzA1=array();$K4kzA1[]='error';$K4kzA1[]='ËØ•ÂïÜÊà∑Êú™ÂêØÁî®Ê≠§ÊîØ‰ªòÊ∏†ÈÅìÔºÅ';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx4m;K4kldMhx4n:K4kx4m:goto K4kx4k;K4kldMhx4l:K4kx4k:$K4kzAvP1=array();$K4kzAvP1['channel_id']=$channel->id;$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->select();$accounts=$K4ktIA0;if(empty($accounts))goto K4keWjgx4p;goto K4kldMhx4p;K4keWjgx4p:$K4kvPA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kvPA1=$K4kvPA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';$this->assign('error',$K4kvPA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx4o;K4kldMhx4p:K4kx4o:unset($K4ktIA0);$K4ktIA0=$accounts[0];$account=$K4ktIA0;$√›œ“¯ŒÊ="count";$K4keF0=$√›œ“¯ŒÊ($accounts);$K4kA0=$K4keF0>1;if($K4kA0)goto K4keWjgx4r;goto K4kldMhx4r;K4keWjgx4r:$Ôõ†ˆ◊π‰="count";$K4keFvPvPvPvP0=$Ôõ†ˆ◊π‰($accounts);$K4kvPvPvPvPA0=$K4keFvPvPvPvP0-1;$È’Ÿ“ÃÀΩ="rand";$K4keFvPvPvP1=$È’Ÿ“ÃÀΩ(0,$K4kvPvPvPvPA0);$Ùü¿πè…Ü="floor";$K4keFvPvP2=$Ùü¿πè…Ü($K4keFvPvPvP1);unset($K4ktIA1);$K4ktIA1=$accounts[intval($K4keFvPvP2)];$account=$K4ktIA1;goto K4kx4q;K4kldMhx4r:K4kx4q:$K4kA0=!$account;if($K4kA0)goto K4keWjgx4t;goto K4kldMhx4t;K4keWjgx4t:$K4kvPA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kvPA1=$K4kvPA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';$this->assign('error',$K4kvPA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx4s;K4kldMhx4t:K4kx4s:$K4kA0=input('bankid')!='';if($K4kA0)goto K4keWjgx4v;goto K4kldMhx4v;K4keWjgx4v:unset($K4ktIA0);$K4ktIA0=input('bankid');$channel->bankid=$K4ktIA0;goto K4kx4u;K4kldMhx4v:K4kx4u:unset($K4ktIA0);$K4ktIA0=$channel->paytype;$data['paytype']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$channel->id;$data['channel_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$account->id;$data['channel_account_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=get_sms_cost();$smsPrice=$K4ktIA0;$√ã´Çåùœ="round";$K4keF0=$√ã´Çåùœ($data['total_price'],2);$K4kA0=$K4keF0<$smsPrice;$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgx51;goto K4kldMhx51;K4keWjgx51:$K4kA1=$data['sms_payer']==1;$K4kA2=(bool)$K4kA1;goto K4kx5z;K4kldMhx51:K4kx5z:$K4kA4=(bool)$K4kA2;if($K4kA4)goto K4keWjgx4y;goto K4kldMhx4y;K4keWjgx4y:$K4kA3=$data['sms_notify']==1;$K4kA4=(bool)$K4kA3;goto K4kx4x;K4kldMhx4y:K4kx4x:if($K4kA4)goto K4keWjgx52;goto K4kldMhx52;K4keWjgx52:$K4kzA1=array();$K4kzA1[]='error';$K4kzA1[]='ËÆ¢ÂçïÈáëÈ¢ù‰∏çË∂≥‰ª•Êâ£Èô§Áü≠‰ø°Ë¥π';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx4w;K4kldMhx52:K4kx4w:unset($K4ktIA0);$K4ktIA0=get_user_rate($user->id,$channel->id);$data['rate']=$K4ktIA0;$K4kvPA0=$data['rate']*$data['total_product_price'];$ù√¸Ω»˚∫="round";$K4keF0=$ù√¸Ω»˚∫($K4kvPA0,3);unset($K4ktIA1);$K4ktIA1=$K4keF0;$data['fee']=$K4ktIA1;$K4kA0=$data['fee']<sysconf('transaction_min_fee');if($K4kA0)goto K4keWjgx54;goto K4kldMhx54;K4keWjgx54:unset($K4ktIA0);$K4ktIA0=sysconf('transaction_min_fee');$data['fee']=$K4ktIA0;goto K4kx53;K4kldMhx54:K4kx53:unset($K4ktIA0);$K4ktIA0=Db::name('user')->where('id',$data['user_id'])->value('fee_payer');$fee_payer=$K4ktIA0;$K4kA0=0==$fee_payer;if($K4kA0)goto K4keWjgx56;goto K4kldMhx56;K4keWjgx56:unset($K4ktIA0);$K4ktIA0=sysconf('fee_payer');$fee_payer=$K4ktIA0;goto K4kx55;K4kldMhx56:K4kx55:unset($K4ktIA0);$K4ktIA0=$fee_payer;$data['fee_payer']=$K4ktIA0;$K4kA0=$fee_payer==2;if($K4kA0)goto K4keWjgx58;goto K4kldMhx58;K4keWjgx58:unset($K4ktIA0);$K4ktIA0=bcadd($data['total_price'],$data['fee'],4);$data['total_price']=$K4ktIA0;goto K4kx57;K4kldMhx58:K4kx57:unset($K4ktIA0);$K4ktIA0=0;$data['agent_rate']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=0;$data['agent_fee']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=0;$data['status']=$K4ktIA0;$K4kA0=$data['sms_payer']==1;$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgx5b;goto K4kldMhx5b;K4keWjgx5b:$K4kA1=$data['total_product_price']<$data['sms_price'];$K4kA2=(bool)$K4kA1;goto K4kx5a;K4kldMhx5b:K4kx5a:if($K4kA2)goto K4keWjgx5c;goto K4kldMhx5c;K4keWjgx5c:$K4kA0=$user->money<$data['sms_price'];if($K4kA0)goto K4keWjgx5e;goto K4kldMhx5e;K4keWjgx5e:return 'ÂïÜÊà∑‰ΩôÈ¢ù‰∏çË∂≥‰ª•ÊîØ‰ªòÁü≠‰ø°Ë¥πÁî®ÔºåËØ∑ËÅîÁ≥ªÂïÜÂÆ∂';goto K4kx5d;K4kldMhx5e:K4kx5d:goto K4kx59;K4kldMhx5c:K4kx59:unset($K4ktIA0);$K4ktIA0=$user->settlement_type;$data['settlement_type']=$K4ktIA0;$K4kA0=$data['settlement_type']==-1;if($K4kA0)goto K4keWjgx5g;goto K4kldMhx5g;K4keWjgx5g:unset($K4ktIA0);$K4ktIA0=sysconf('settlement_type');$data['settlement_type']=$K4ktIA0;goto K4kx5f;K4kldMhx5g:K4kx5f:unset($K4ktIA0);$K4ktIA0=$channel->id;$type=$K4ktIA0;$K4kA0=$type=='71';$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgx5v;goto K4kldMhx5v;K4keWjgx5v:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="ismobile";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kA1=$K4khC0=='1';$K4kA2=(bool)$K4kA1;goto K4kx5u;K4kldMhx5v:K4kx5u:$K4kA4=(bool)$K4kA2;$K4kAK=!$K4kA4;if($K4kAK)goto K4keWjgx5t;goto K4kldMhx5t;K4keWjgx5t:$K4kA3=$type=='77';$K4kA4=(bool)$K4kA3;goto K4kx5s;K4kldMhx5t:K4kx5s:$K4kA6=(bool)$K4kA4;$K4kAJ=!$K4kA6;if($K4kAJ)goto K4keWjgx5r;goto K4kldMhx5r;K4keWjgx5r:$K4kA5=$type=='78';$K4kA6=(bool)$K4kA5;goto K4kx5q;K4kldMhx5r:K4kx5q:$K4kA8=(bool)$K4kA6;$K4kAI=!$K4kA8;if($K4kAI)goto K4keWjgx5p;goto K4kldMhx5p;K4keWjgx5p:$K4kA7=$type=='79';$K4kA8=(bool)$K4kA7;goto K4kx5o;K4kldMhx5p:K4kx5o:$K4kAA=(bool)$K4kA8;$K4kAH=!$K4kAA;if($K4kAH)goto K4keWjgx5n;goto K4kldMhx5n;K4keWjgx5n:$K4kA9=$type=='80';$K4kAA=(bool)$K4kA9;goto K4kx5m;K4kldMhx5n:K4kx5m:$K4kAC=(bool)$K4kAA;$K4kAG=!$K4kAC;if($K4kAG)goto K4keWjgx5l;goto K4kldMhx5l;K4keWjgx5l:$K4kAB=$type=='167';$K4kAC=(bool)$K4kAB;goto K4kx5k;K4kldMhx5l:K4kx5k:$K4kAE=(bool)$K4kAC;$K4kAF=!$K4kAE;if($K4kAF)goto K4keWjgx5j;goto K4kldMhx5j;K4keWjgx5j:$K4kAD=$type=='170';$K4kAE=(bool)$K4kAD;goto K4kx5i;K4kldMhx5j:K4kx5i:if($K4kAE)goto K4keWjgx5w;goto K4kldMhx5w;K4keWjgx5w:unset($K4ktIA0);$K4ktIA0=OrderModel::create($data);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx5y;goto K4kldMhx5y;K4keWjgx5y:return 'ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';goto K4kx5x;K4kldMhx5y:K4kx5x:session('last_order_trade_no',$data['trade_no']);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('isMobile',$this->request->isMobile());$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx5h;K4kldMhx5w:K4kx5h:$K4kA0=!session('openid');$K4kA1=(bool)$K4kA0;if($K4kA1)goto K4keWjgx64;goto K4kldMhx64;K4keWjgx64:unset($K4ktIA4);$K4ktIA4="strpos";$Í´≠ªœË–=$K4ktIA4;$K4keF1=$Í´≠ªœË–($_SERVER['HTTP_USER_AGENT'],'MicroMessenger');$K4kA1=(bool)$K4keF1;goto K4kx63;K4kldMhx64:K4kx63:$K4kA3=(bool)$K4kA1;if($K4kA3)goto K4keWjgx62;goto K4kldMhx62;K4keWjgx62:$K4kA2=$channel->code=='UcyWxpay';$K4kA3=(bool)$K4kA2;goto K4kx61;K4kldMhx62:K4kx61:if($K4kA3)goto K4keWjgx65;goto K4kldMhx65;K4keWjgx65:$K4kA0=url('index/pay/wxjspay') . '?trade_no=';$K4kA1=$K4kA0 . $data['trade_no'];unset($K4ktIA2);$K4ktIA2=$K4kA1;$url=$K4ktIA2;unset($K4ktIA0);$K4ktIA0=$url;$data['pay_url']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=2;$data['pay_content_type']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=OrderModel::create($data);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx67;goto K4kldMhx67;K4keWjgx67:return 'ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';goto K4kx66;K4kldMhx67:K4kx66:$K4kvPA0='Location: ' . $url;$‘îè¨ÑÂö="header";$K4keF0=$‘îè¨ÑÂö($K4kvPA0);die();goto K4kx6z;K4kldMhx65:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kA0=sysconf('buy_notice')=='2';if($K4kA0)goto K4keWjgx69;goto K4kldMhx69;K4keWjgx69:$K4kvPA0='' . sysconf('buy_notice_con');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $data['trade_no'];$™ È•‰ßÃ="round";$K4keFvP1=$™ È•‰ßÃ($data['total_price'],2);unset($K4kcV3);$∞¬Øˆé∏»="is_array";$K4keF6=$∞¬Øˆé∏»($data);if($K4keF6)goto K4keWjgx6b;goto K4kldMhx6b;K4keWjgx6b:$K4kcV3=&$data['trade_no'];goto K4kx6a;K4kldMhx6b:$K4kcV3=$data['trade_no'];K4kx6a:$K4kzA4=array();$K4kzA4[]=&$K4kcV3;$K4kzA4[]=&$K4kvPA2;$K4kzA4[]=&$K4keFvP1;$K4kzA5=array();$K4kzA5[]=$PayAPI;$K4kzA5[]="order";$K4khC2=call_user_func_array($K4kzA5,$K4kzA4);unset($K4ktIA3);$K4ktIA3=$K4khC2;$res=$K4ktIA3;goto K4kx68;K4kldMhx69:$K4kvPA0='ÂïÜÂìÅÂêçÁß∞Ôºö' . $data['goods_name'];$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $data['trade_no'];$‹Â≠ÜÍ¸="round";$K4keFvP0=$‹Â≠ÜÍ¸($data['total_price'],2);unset($K4kcV2);$ú∑òôÑÙ¢="is_array";$K4keF5=$ú∑òôÑÙ¢($data);if($K4keF5)goto K4keWjgx6d;goto K4kldMhx6d;K4keWjgx6d:$K4kcV2=&$data['trade_no'];goto K4kx6c;K4kldMhx6d:$K4kcV2=$data['trade_no'];K4kx6c:$K4kzA3=array();$K4kzA3[]=&$K4kcV2;$K4kzA3[]=&$K4kvPA2;$K4kzA3[]=&$K4keFvP0;$K4kzA4=array();$K4kzA4[]=$PayAPI;$K4kzA4[]="order";$K4khC1=call_user_func_array($K4kzA4,$K4kzA3);unset($K4ktIA3);$K4ktIA3=$K4khC1;$res=$K4ktIA3;K4kx68:$K4kA0=$res===false;if($K4kA0)goto K4keWjgx6f;goto K4kldMhx6f;K4keWjgx6f:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khCvP0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('error',$K4khCvP0);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx6e;K4kldMhx6f:K4kx6e:unset($K4ktIA0);$K4ktIA0=$res->pay_url;$data['pay_url']=$K4ktIA0;if(isset($res->content_type))goto K4keWjgx6h;goto K4kldMhx6h;K4keWjgx6h:$K4kA0=$res->content_type;goto K4kx6g;K4kldMhx6h:$K4kA0=1;K4kx6g:unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['pay_content_type']=$K4ktIA1;K4kx6z:unset($K4ktIA0);$K4ktIA0=OrderModel::create($data);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx6j;goto K4kldMhx6j;K4keWjgx6j:return 'ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';goto K4kx6i;K4kldMhx6j:K4kx6i:session('last_order_trade_no',$data['trade_no']);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('isMobile',$this->request->isMobile());$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;}public function api(){unset($K4ktIA0);$K4ktIA0=input('amount/f',0);$amount=$K4ktIA0;$K4kA0=$amount<=0;if($K4kA0)goto K4keWjgx6l;goto K4kldMhx6l;K4keWjgx6l:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ËÆ¢ÂçïÈáëÈ¢ù‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6k;K4kldMhx6l:K4kx6k:unset($K4ktIA0);$K4ktIA0=session('token');$token=$K4ktIA0;$K4kA0=!$token;if($K4kA0)goto K4keWjgx6n;goto K4kldMhx6n;K4keWjgx6n:$»©àÇé–Õ="time";$K4keFvP0=$»©àÇé–Õ();$ö¶â¬Ñ¨«="time";$K4keFvPvP1=$ö¶â¬Ñ¨«();$´˜‹•Ë›Ò="md5";$K4keFvP2=$´˜‹•Ë›Ò($K4keFvPvP1);$K4kvPA0=$K4keFvP0 . $K4keFvP2;$≥ÎÈÆ˙ƒÛ="time";$K4keFvP3=$≥ÎÈÆ˙ƒÛ();$K4kvPA1=$K4kvPA0 . $K4keFvP3;$ıì’⁄ñŸß="md5";$K4keF4=$ıì’⁄ñŸß($K4kvPA1);$é¶”ÿ∏â¢="time";$K4keF5=$é¶”ÿ∏â¢();$K4kA2=$K4keF4 . $K4keF5;unset($K4ktIA3);$K4ktIA3=$K4kA2;$token=$K4ktIA3;session('token',$token);goto K4kx6m;K4kldMhx6n:K4kx6m:$K4kzA1=array();$K4kzA1[]='token';$K4kzA1[]=&$token;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzAvP1=array();$K4kzAvP1['id']=input('userid/d',0);$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=UserModel::get($K4kzAvP1);$user=$K4ktIA0;$K4kA0=!$user;if($K4kA0)goto K4keWjgx6p;goto K4kldMhx6p;K4keWjgx6p:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÂïÜÊà∑Âè∑‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6o;K4kldMhx6p:K4kx6o:if(empty($user['key']))goto K4keWjgx6r;goto K4kldMhx6r;K4keWjgx6r:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='Êú™ÂºÄÈÄöÊé•ÂÖ•ÊùÉÈôê';return json($K4kzAvP0);goto K4kx6q;K4kldMhx6r:K4kx6q:unset($K4ktIA0);$K4ktIA0=$user->id;$data['user_id']=$K4ktIA0;$∞èéöœ≥µ="date";$K4keF0=$∞èéöœ≥µ('YmdHis');$áá¬ê¯¿¸="mt_rand";$K4keFvP1=$áá¬ê¯¿¸(1,99999);$K4kA0=$K4keF0 . str_pad($K4keFvP1,5,'0',STR_PAD_LEFT);unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['trade_no']=$K4ktIA1;unset($K4ktIA0);$K4ktIA0=input('orderno/s','');$data['orderno']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$_SERVER['REQUEST_TIME'];$data['create_at']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$this->request->ip();$data['create_ip']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$amount;$data['total_product_price']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$amount;$data['total_price']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$amount;$data['total_cost_price']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('title/s','');$data['goods_name']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('notify_url/s','');$data['notify_url']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=input('return_url/s','');$data['return_url']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=1;$data['category']=$K4ktIA0;if(empty($data['trade_no']))goto K4keWjgx6t;goto K4kldMhx6t;K4keWjgx6t:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ËÆ¢ÂçïÂè∑‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6s;K4kldMhx6t:K4kx6s:if(empty($data['goods_name']))goto K4keWjgx6v;goto K4kldMhx6v;K4keWjgx6v:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÂïÜÂìÅÂêçÁß∞‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6u;K4kldMhx6v:K4kx6u:if(empty($data['notify_url']))goto K4keWjgx6x;goto K4kldMhx6x;K4keWjgx6x:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÂºÇÊ≠•ÂõûË∞ÉÂú∞ÂùÄ‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6w;K4kldMhx6x:K4kx6w:if(empty($data['return_url']))goto K4keWjgx7z;goto K4kldMhx7z;K4keWjgx7z:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='Ë∑≥ËΩ¨Âú∞ÂùÄ‰∏çÊ≠£Á°Æ';return json($K4kzAvP0);goto K4kx6y;K4kldMhx7z:K4kx6y:$K4kzAvP1=array();$K4kzAvP1['code_api']=input('paycode/s',0);$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=ChannelModel::get($K4kzAvP1);$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgx72;goto K4kldMhx72;K4keWjgx72:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÊîØ‰ªòÈÄöÈÅì‰∏çÂèØÁî®ÔºÅ';return json($K4kzAvP0);goto K4kx71;K4kldMhx72:K4kx71:unset($K4ktIA0);$K4ktIA0=Db::name('rate_group_user')->where('user_id',$user->id)->find();$rate_group_user=$K4ktIA0;$K4kA0=!empty($rate_group_user);if($K4kA0)goto K4keWjgx74;goto K4kldMhx74;K4keWjgx74:$K4kzAvP1=array();$K4kzAvP1['group_id']=$rate_group_user['group_id'];$K4kzAvP1['channel_id']=$channel->id;$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=Db::name('rate_group_rule')->where($K4kzAvP1)->find();$rate_group_rule=$K4ktIA0;if(empty($rate_group_rule))goto K4keWjgx76;goto K4kldMhx76;K4keWjgx76:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÊîØ‰ªòÈÄöÈÅì‰∏çÂèØÁî®ÔºÅ';return json($K4kzAvP0);$K4kzA1=array();$K4kzA1[]='error';$K4kzA1[]='ËØ•ÂïÜÊà∑Êú™ÂêØÁî®Ê≠§ÊîØ‰ªòÊ∏†ÈÅìÔºÅ';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx75;K4kldMhx76:K4kx75:goto K4kx73;K4kldMhx74:K4kx73:$K4kzAvP1=array();$K4kzAvP1['channel_id']=$channel->id;$K4kzAvP1['status']=1;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->select();$accounts=$K4ktIA0;if(empty($accounts))goto K4keWjgx78;goto K4kldMhx78;K4keWjgx78:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÊîØ‰ªòÈÄöÈÅì‰∏çÂèØÁî®ÔºÅ';return json($K4kzAvP0);$K4kvPA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kvPA1=$K4kvPA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';$this->assign('error',$K4kvPA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx77;K4kldMhx78:K4kx77:unset($K4ktIA0);$K4ktIA0=$accounts[0];$account=$K4ktIA0;$ƒÀõî¨∂ò="count";$K4keF0=$ƒÀõî¨∂ò($accounts);$K4kA0=$K4keF0>1;if($K4kA0)goto K4keWjgx7a;goto K4kldMhx7a;K4keWjgx7a:$åöâÈœπâ="count";$K4keFvPvPvPvP0=$åöâÈœπâ($accounts);$K4kvPvPvPvPA0=$K4keFvPvPvPvP0-1;$Ó‘íÊπÂ™="rand";$K4keFvPvPvP1=$Ó‘íÊπÂ™(0,$K4kvPvPvPvPA0);$€»êƒ‡ÿ®="floor";$K4keFvPvP2=$€»êƒ‡ÿ®($K4keFvPvPvP1);unset($K4ktIA1);$K4ktIA1=$accounts[intval($K4keFvPvP2)];$account=$K4ktIA1;goto K4kx79;K4kldMhx7a:K4kx79:$K4kA0=!$account;if($K4kA0)goto K4keWjgx7c;goto K4kldMhx7c;K4keWjgx7c:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ÊîØ‰ªòÈÄöÈÅì‰∏çÂèØÁî®ÔºÅ';return json($K4kzAvP0);$K4kvPA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kvPA1=$K4kvPA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';$this->assign('error',$K4kvPA1);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx7b;K4kldMhx7c:K4kx7b:$K4kA0=input('bankid')!='';if($K4kA0)goto K4keWjgx7e;goto K4kldMhx7e;K4keWjgx7e:unset($K4ktIA0);$K4ktIA0=input('bankid');$channel->bankid=$K4ktIA0;goto K4kx7d;K4kldMhx7e:K4kx7d:unset($K4ktIA0);$K4ktIA0=$channel->paytype;$data['paytype']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$channel->id;$data['channel_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$account->id;$data['channel_account_id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=get_user_rate_api($user->id,$channel->id);$data['rate']=$K4ktIA0;$K4kvPA0=$data['rate']*$data['total_product_price'];$…ã—˜¬Éﬂ="round";$K4keF0=$…ã—˜¬Éﬂ($K4kvPA0,3);unset($K4ktIA1);$K4ktIA1=$K4keF0;$data['fee']=$K4ktIA1;$K4kA0=$data['fee']<sysconf('transaction_min_fee');if($K4kA0)goto K4keWjgx7g;goto K4kldMhx7g;K4keWjgx7g:unset($K4ktIA0);$K4ktIA0=sysconf('transaction_min_fee');$data['fee']=$K4ktIA0;goto K4kx7f;K4kldMhx7g:K4kx7f:unset($K4ktIA0);$K4ktIA0=Db::name('user')->where('id',$data['user_id'])->value('fee_payer');$fee_payer=$K4ktIA0;$K4kA0=0==$fee_payer;if($K4kA0)goto K4keWjgx7i;goto K4kldMhx7i;K4keWjgx7i:unset($K4ktIA0);$K4ktIA0=sysconf('fee_payer');$fee_payer=$K4ktIA0;goto K4kx7h;K4kldMhx7i:K4kx7h:unset($K4ktIA0);$K4ktIA0=$fee_payer;$data['fee_payer']=$K4ktIA0;$K4kA0=$fee_payer==2;if($K4kA0)goto K4keWjgx7k;goto K4kldMhx7k;K4keWjgx7k:unset($K4ktIA0);$K4ktIA0=bcadd($data['total_price'],$data['fee'],4);$data['total_price']=$K4ktIA0;goto K4kx7j;K4kldMhx7k:K4kx7j:unset($K4ktIA0);$K4ktIA0=0;$data['agent_rate']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=0;$data['agent_fee']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=0;$data['status']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$user->settlement_type;$data['settlement_type']=$K4ktIA0;$K4kA0=$data['settlement_type']==-1;if($K4kA0)goto K4keWjgx7m;goto K4kldMhx7m;K4keWjgx7m:unset($K4ktIA0);$K4ktIA0=sysconf('settlement_type');$data['settlement_type']=$K4ktIA0;goto K4kx7l;K4kldMhx7m:K4kx7l:unset($K4ktIA0);$K4ktIA0=$channel->id;$type=$K4ktIA0;$K4kA0=$type=='71';$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgx82;goto K4kldMhx82;K4keWjgx82:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="ismobile";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kA1=$K4khC0=='1';$K4kA2=(bool)$K4kA1;goto K4kx81;K4kldMhx82:K4kx81:$K4kA4=(bool)$K4kA2;$K4kAK=!$K4kA4;if($K4kAK)goto K4keWjgx8z;goto K4kldMhx8z;K4keWjgx8z:$K4kA3=$type=='77';$K4kA4=(bool)$K4kA3;goto K4kx7y;K4kldMhx8z:K4kx7y:$K4kA6=(bool)$K4kA4;$K4kAJ=!$K4kA6;if($K4kAJ)goto K4keWjgx7x;goto K4kldMhx7x;K4keWjgx7x:$K4kA5=$type=='78';$K4kA6=(bool)$K4kA5;goto K4kx7w;K4kldMhx7x:K4kx7w:$K4kA8=(bool)$K4kA6;$K4kAI=!$K4kA8;if($K4kAI)goto K4keWjgx7v;goto K4kldMhx7v;K4keWjgx7v:$K4kA7=$type=='79';$K4kA8=(bool)$K4kA7;goto K4kx7u;K4kldMhx7v:K4kx7u:$K4kAA=(bool)$K4kA8;$K4kAH=!$K4kAA;if($K4kAH)goto K4keWjgx7t;goto K4kldMhx7t;K4keWjgx7t:$K4kA9=$type=='80';$K4kAA=(bool)$K4kA9;goto K4kx7s;K4kldMhx7t:K4kx7s:$K4kAC=(bool)$K4kAA;$K4kAG=!$K4kAC;if($K4kAG)goto K4keWjgx7r;goto K4kldMhx7r;K4keWjgx7r:$K4kAB=$type=='167';$K4kAC=(bool)$K4kAB;goto K4kx7q;K4kldMhx7r:K4kx7q:$K4kAE=(bool)$K4kAC;$K4kAF=!$K4kAE;if($K4kAF)goto K4keWjgx7p;goto K4kldMhx7p;K4keWjgx7p:$K4kAD=$type=='170';$K4kAE=(bool)$K4kAD;goto K4kx7o;K4kldMhx7p:K4kx7o:if($K4kAE)goto K4keWjgx83;goto K4kldMhx83;K4keWjgx83:unset($K4ktIA0);$K4ktIA0=OrderModel::create($data);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx85;goto K4kldMhx85;K4keWjgx85:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';return json($K4kzAvP0);return 'ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';goto K4kx84;K4kldMhx85:K4kx84:session('last_order_trade_no',$data['trade_no']);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('isMobile',$this->request->isMobile());$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx7n;K4kldMhx83:K4kx7n:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kvPA0='ÊäïËØâQQÔºö' . sysconf('site_info_qq');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $data['trade_no'];$âÄ¢°ä÷´="round";$K4keFvP1=$âÄ¢°ä÷´($data['total_price'],2);unset($K4kcV3);$Û›ã£Ù√∆="is_array";$K4keF6=$Û›ã£Ù√∆($data);if($K4keF6)goto K4keWjgx87;goto K4kldMhx87;K4keWjgx87:$K4kcV3=&$data['trade_no'];goto K4kx86;K4kldMhx87:$K4kcV3=$data['trade_no'];K4kx86:$K4kzA4=array();$K4kzA4[]=&$K4kcV3;$K4kzA4[]=&$K4kvPA2;$K4kzA4[]=&$K4keFvP1;$K4kzA5=array();$K4kzA5[]=$PayAPI;$K4kzA5[]="order";$K4khC2=call_user_func_array($K4kzA5,$K4kzA4);unset($K4ktIA3);$K4ktIA3=$K4khC2;$res=$K4ktIA3;$K4kA0=$res===false;if($K4kA0)goto K4keWjgx89;goto K4kldMhx89;K4keWjgx89:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khCvP0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('error',$K4khCvP0);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kx88;K4kldMhx89:K4kx88:unset($K4ktIA0);$K4ktIA0=$res->pay_url;$data['pay_url']=$K4ktIA0;if(isset($res->content_type))goto K4keWjgx8b;goto K4kldMhx8b;K4keWjgx8b:$K4kA0=$res->content_type;goto K4kx8a;K4kldMhx8b:$K4kA0=1;K4kx8a:unset($K4ktIA1);$K4ktIA1=$K4kA0;$data['pay_content_type']=$K4ktIA1;unset($K4ktIA0);$K4ktIA0=OrderModel::create($data);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx8d;goto K4kldMhx8d;K4keWjgx8d:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';return json($K4kzAvP0);return 'ËÆ¢ÂçïÂàõÂª∫Â§±Ë¥•ÔºåËØ∑ÈáçËØïÔºÅ';goto K4kx8c;K4kldMhx8d:K4kx8c:session('last_order_trade_no',$data['trade_no']);$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('isMobile',$this->request->isMobile());$K4kzAvP0=array();$K4kzAvP0['id']=$order['user_id'];unset($K4ktIA0);$K4ktIA0=db('user')->where($K4kzAvP0)->value('key');$key=$K4ktIA0;$K4kzA0=array();$K4kzA0['title']=$order['goods_name'];$K4kzA0['userid']=$order['user_id'];$K4kzA0['notify_url']=$order['notify_url'];$K4kzA0['return_url']=$order['return_url'];$K4kzA0['amount']=$order['total_price'];$K4kzA0['orderno']=$order['orderno'];unset($K4ktIA0);$K4ktIA0=$K4kzA0;$param=$K4ktIA0;ksort($param);$K4kvPA0=http_build_query($param) . $key;$ÃÑû≈ø˘„="md5";$K4keF1=$ÃÑû≈ø˘„($K4kvPA0);unset($K4ktIA1);$K4ktIA1=$K4keF1;$sign=$K4ktIA1;$K4kA0=$sign!==input('sign/s','');if($K4kA0)goto K4keWjgx8f;goto K4kldMhx8f;K4keWjgx8f:$K4kzAvP0=array();$K4kzAvP0['errcode']=1;$K4kzAvP0['errmsg']='Á≠æÂêçÈîôËØØ';return json($K4kzAvP0);goto K4kx8e;K4kldMhx8f:K4kx8e:$K4kA0='<form action="/index/pay/payment" method="post" id="fromgo">
			<input type="hidden" name="trade_no" value="' . $data['trade_no'];$K4kA1=$K4kA0 . '">
		</form>
		<script type="text/javascript">
			document.getElementById("fromgo").submit();
		</script>';return $K4kA1;}public function payway(){$ë®Ñ£„õÜ="header";$K4keF0=$ë®Ñ£„õÜ("Access-Control-Allow-Origin:*");unset($K4ktIA0);$K4ktIA0=get_user_channels(10438);$userChannels=$K4ktIA0;$K4kzA0=array();unset($K4ktIA0);$K4ktIA0=$K4kzA0;$data=$K4ktIA0;unset($K4kEc1);$K4kEc1=array();foreach($userChannels as $key=>$row){$K4kEc1[$key]=$row;};$K4k1i=0;K4kx8t:$ØÆì∑Á¥ã="count";$K4keF0=$ØÆì∑Á¥ã($K4kEc1);$K4kA0=$K4k1i<$K4keF0;if($K4kA0)goto K4keWjgx9e;goto K4kldMhx9e;K4keWjgx9e:unset($K4ktIA0);$K4ktIA0="array_keys";$”©—¥ÈÀ›=$K4ktIA0;$K4keF0=$”©—¥ÈÀ›($K4kEc1);unset($K4ktIA0);$K4ktIA0=$K4keF0;$key=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$key[$K4k1i];$key=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$K4kEc1[$key];$row=$K4ktIA0;$K4kA0=$row['status']==0;if($K4kA0)goto K4keWjgx9g;goto K4kldMhx9g;K4keWjgx9g:goto K4keWjgx8x;goto K4kx9f;K4kldMhx9g:K4kx9f:goto K4kldMhx8x;K4keWjgx8x:goto K4keWjgx8h;goto K4kx8w;K4kldMhx8x:K4kx8w:goto K4kldMhx8h;K4keWjgx8h:unset($userChannels[$key]);goto K4kx8g;K4kldMhx8h:K4kx8g:if($this->request->isMobile())goto K4keWjgx9i;goto K4kldMhx9i;K4keWjgx9i:goto K4keWjgx9z;goto K4kx9h;K4kldMhx9i:K4kx9h:goto K4kldMhx9z;K4keWjgx9z:goto K4keWjgx8j;goto K4kx8y;K4kldMhx9z:K4kx8y:goto K4kldMhx8j;K4keWjgx8j:$K4kA0=$row['is_available']==2;if($K4kA0)goto K4keWjgx9k;goto K4kldMhx9k;K4keWjgx9k:goto K4keWjgx92;goto K4kx9j;K4kldMhx9k:K4kx9j:goto K4kldMhx92;K4keWjgx92:goto K4keWjgx8l;goto K4kx91;K4kldMhx92:K4kx91:goto K4kldMhx8l;K4keWjgx8l:unset($userChannels[$key]);goto K4kx8k;K4kldMhx8l:K4kx8k:goto K4kx8i;K4kldMhx8j:$K4kA0=!$this->request->isMobile();$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgx9m;goto K4kldMhx9m;K4keWjgx9m:goto K4keWjgx94;goto K4kx9l;K4kldMhx9m:K4kx9l:goto K4kldMhx94;K4keWjgx94:goto K4keWjgx8n;goto K4kx93;K4kldMhx94:K4kx93:goto K4kldMhx8n;K4keWjgx8n:$K4kA1=$row['is_available']==1;$K4kA2=(bool)$K4kA1;goto K4kx8m;K4kldMhx8n:K4kx8m:if($K4kA2)goto K4keWjgx9o;goto K4kldMhx9o;K4keWjgx9o:goto K4keWjgx96;goto K4kx9n;K4kldMhx9o:K4kx9n:goto K4kldMhx96;K4keWjgx96:goto K4keWjgx8o;goto K4kx95;K4kldMhx96:K4kx95:goto K4kldMhx8o;K4keWjgx8o:unset($userChannels[$key]);goto K4kx8i;K4kldMhx8o:K4kx8i:$K4kA0=$row['is_available']==0;if($K4kA0)goto K4keWjgx9q;goto K4kldMhx9q;K4keWjgx9q:goto K4keWjgx98;goto K4kx9p;K4kldMhx9q:K4kx9p:goto K4kldMhx98;K4keWjgx98:goto K4keWjgx8q;goto K4kx97;K4kldMhx98:K4kx97:goto K4kldMhx8q;K4keWjgx8q:unset($K4ktIA0);$K4ktIA0='all';$platform=$K4ktIA0;goto K4kx8p;K4kldMhx8q:$K4kA0=$row['is_available']==1;if($K4kA0)goto K4keWjgx9s;goto K4kldMhx9s;K4keWjgx9s:goto K4keWjgx9a;goto K4kx9r;K4kldMhx9s:K4kx9r:goto K4kldMhx9a;K4keWjgx9a:goto K4keWjgx8r;goto K4kx99;K4kldMhx9a:K4kx99:goto K4kldMhx8r;K4keWjgx8r:unset($K4ktIA0);$K4ktIA0='mobile';$platform=$K4ktIA0;goto K4kx8p;K4kldMhx8r:$K4kA0=$row['is_available']==2;if($K4kA0)goto K4keWjgx9u;goto K4kldMhx9u;K4keWjgx9u:goto K4keWjgx9c;goto K4kx9t;K4kldMhx9u:K4kx9t:goto K4kldMhx9c;K4keWjgx9c:goto K4keWjgx8s;goto K4kx9b;K4kldMhx9c:K4kx9b:goto K4kldMhx8s;K4keWjgx8s:unset($K4ktIA0);$K4ktIA0='pc';$platform=$K4ktIA0;goto K4kx8p;K4kldMhx8s:K4kx8p:$K4kzA0=array();$K4kzA0['id']=$row['channel_id'];$K4kzA0['title']=$row['title'];$K4kzA0['platform']=$platform;unset($K4ktIA0);$K4ktIA0=$K4kzA0;$data[]=$K4ktIA0;K4kx8u:$K4k1i=$K4k1i+1;goto K4kx8t;goto K4kx9d;K4kldMhx9e:K4kx9d:K4kx8v:return json_encode($data);}public function page_callback(){$K4kvPA0=LOG_PATH . 'page_callback.txt';$÷Œ÷©≈∞ ="date";$K4keFvP0=$÷Œ÷©≈∞ ('Y-m-d H:i:s');$K4kvPA1="„Äê" . $K4keFvP0;$K4kvPA2=$K4kvPA1 . "„Äë
";$§˘»Éú–´="file_get_contents";$K4keFvP1=$§˘»Éú–´("php://input");$K4kvPA3=$K4kvPA2 . $K4keFvP1;$K4kvPA4=$K4kvPA3 . "

";$«¢ﬁΩÙäÒ="file_put_contents";$K4keF2=$«¢ﬁΩÙäÒ($K4kvPA0,$K4kvPA4,FILE_APPEND);unset($K4ktIA0);$K4ktIA0=input('');$params=$K4ktIA0;record_file_log('pay_page',json_encode($params));if(isset($params['channel']))goto K4keWjgx9w;goto K4kldMhx9w;K4keWjgx9w:unset($params['channel']);goto K4kx9v;K4kldMhx9w:K4kx9v:$K4kzA1=array();$K4kzA1[]=&$params;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="getChannelName";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=$K4khC0;$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgx9y;goto K4kldMhx9y;K4keWjgx9y:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ';record_file_log('pay_error',$K4kvPA0);die('‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ');goto K4kx9x;K4kldMhx9y:K4kx9x:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxa1;goto K4kldMhxa1;K4keWjgxa1:$K4kA0=!empty($order['return_url']);if($K4kA0)goto K4keWjgxa3;goto K4kldMhxa3;K4keWjgxa3:$K4kvPA0='location:' . $order['return_url'];$K4kvPA1=$K4kvPA0 . '?orderno=';$K4kvPA2=$K4kvPA1 . $order->orderno;header($K4kvPA2);exit();goto K4kxa2;K4kldMhxa3:K4kxa2:$K4kvPA0=$trade_no . 'ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ';record_file_log('pay_error',$K4kvPA0);$K4kvPA0='location:' . url('/orderquery');$K4kvPA1=$K4kvPA0 . '?orderid=';$K4kvPA2=$K4kvPA1 . $trade_no;$√∆é§ïºè="header";$K4keF1=$√∆é§ïºè($K4kvPA2);die('ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ');goto K4kxaz;K4kldMhxa1:K4kxaz:unset($K4ktIA0);$K4ktIA0=$order->channel;$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgxa5;goto K4kldMhxa5;K4keWjgxa5:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ';record_file_log('pay_error',$K4kvPA0);die('‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ');goto K4kxa4;K4kldMhxa5:K4kxa4:unset($K4ktIA0);$K4ktIA0=$order->channelAccount;$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxa7;goto K4kldMhxa7;K4keWjgxa7:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö';$K4kvPA1=$K4kvPA0 . $channel->title;$K4kvPA2=$K4kvPA1 . 'ÁöÑË¥¶Âè∑ÔºÅ';record_file_log('pay_error',$K4kvPA2);$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';die($K4kA1);goto K4kxa6;K4kldMhxa7:K4kxa6:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kzA1=array();$K4kzA1[]=&$params;$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="page_callback";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);}public function notify_callback(){$K4kvPA0=LOG_PATH . 'notify.txt';$ôÏ¨ˆÿﬁ‰="date";$K4keFvP0=$ôÏ¨ˆÿﬁ‰('Y-m-d H:i:s');$K4kvPA1="„Äê" . $K4keFvP0;$K4kvPA2=$K4kvPA1 . "„Äë
";$ø∆ÂÄäøó="file_get_contents";$K4keFvP1=$ø∆ÂÄäøó("php://input");$K4kvPA3=$K4kvPA2 . $K4keFvP1;$K4kvPA4=$K4kvPA3 . "

";$¿ÍÕÛ©«ã="file_put_contents";$K4keF2=$¿ÍÕÛ©«ã($K4kvPA0,$K4kvPA4,FILE_APPEND);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="getParams";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=$K4khC0;$params=$K4ktIA0;record_file_log('pay_notify',json_encode($params));$K4kzA1=array();$K4kzA1[]=&$params;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="getChannelName";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=$K4khC0;$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgxa9;goto K4kldMhxa9;K4keWjgxa9:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®aËØ•ËÆ¢ÂçïÔºÅ';record_file_log('pay_error',$K4kvPA0);die('‰∏çÂ≠òqÂú®ËØ•ËÆ¢ÂçïÔºÅ');goto K4kxa8;K4kldMhxa9:K4kxa8:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxab;goto K4kldMhxab;K4keWjgxab:$K4kvPA0=$trade_no . 'ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ';record_file_log('pay_error',$K4kvPA0);$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="repeat";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kxaa;K4kldMhxab:K4kxaa:unset($K4ktIA0);$K4ktIA0=$order->channel;$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgxad;goto K4kldMhxad;K4keWjgxad:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ';record_file_log('pay_error',$K4kvPA0);die('‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ');goto K4kxac;K4kldMhxad:K4kxac:unset($K4ktIA0);$K4ktIA0=$order->channelAccount;$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxaf;goto K4kldMhxaf;K4keWjgxaf:$K4kvPA0=$trade_no . '‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö';$K4kvPA1=$K4kvPA0 . $channel->title;$K4kvPA2=$K4kvPA1 . 'ÁöÑË¥¶Âè∑ÔºÅ';record_file_log('pay_error',$K4kvPA2);$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';die($K4kA1);goto K4kxae;K4kldMhxaf:K4kxae:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kzA1=array();$K4kzA1[]=&$params;$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="notify_callback";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);if($K4khC0)goto K4keWjgxah;goto K4kldMhxah;K4keWjgxah:Goods::sendOut($trade_no);$K4kA0=$order['category']==0;if($K4kA0)goto K4keWjgxaj;goto K4kldMhxaj;K4keWjgxaj:$K4kA0=new Stock();unset($K4ktIA1);$K4ktIA1=$K4kA0;$notify=$K4ktIA1;$K4kzAvP0=array();$K4kzAvP0['id']=$order['goods_id'];$K4kzAvP0['status']=1;unset($K4ktIA0);$K4ktIA0=GoodsModel::get($K4kzAvP0);$goods=$K4ktIA0;$notify->notify($goods->user,$goods);goto K4kxai;K4kldMhxaj:K4kxai:$K4kzAvP0=array();$K4kzAvP0['id']=$order['user_id'];unset($K4ktIA0);$K4ktIA0=db('user')->where($K4kzAvP0)->value('key');$key=$K4ktIA0;$K4kzA0=array();$K4kzA0['title']=$order['goods_name'];$K4kzA0['userid']=$order['user_id'];$K4kzA0['notify_url']=$order['notify_url'];$K4kzA0['return_url']=$order['return_url'];$K4kzA0['amount']=$order['total_price'];$K4kzA0['orderno']=$order['orderno'];unset($K4ktIA0);$K4ktIA0=$K4kzA0;$param=$K4ktIA0;ksort($param);$K4kvPA0=http_build_query($param) . $key;$ﬂ†Ÿì´∂–="md5";$K4keF1=$ﬂ†Ÿì´∂–($K4kvPA0);unset($K4ktIA1);$K4ktIA1=$K4keF1;$param['sign']=$K4ktIA1;unset($K4ktIA0);$K4ktIA0=0;$param['errcode']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$order['trade_no'];$param['transaction']=$K4ktIA0;unset($param['userid']);$K4kzAvP0=array();$K4kzAvP0['url']=$order['notify_url'];$K4kzAvP0['data']=$param;wd_http($K4kzAvP0);goto K4kxag;K4kldMhxah:K4kxag:}private function get_discount_price($goods,$quantity){unset($K4ktIA0);$K4ktIA0=$goods->price;$price=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$goods->wholesale_discount_list;$list=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=array_column($list,'num');$sort=$K4ktIA0;array_multisort($sort,SORT_DESC,$list);unset($K4kEc1);$K4kEc1=array();foreach($list as $v){$K4kEc1[]=$v;};$K4k1i=0;K4kxam:$¢…ôëÃ§î="count";$K4keF0=$¢…ôëÃ§î($K4kEc1);$K4kA0=$K4k1i<$K4keF0;if($K4kA0)goto K4keWjgxas;goto K4kldMhxas;K4keWjgxas:$K4k1Key=array_keys($K4kEc1);$K4k1Key=$K4k1Key[$K4k1i];unset($K4ktIA0);$K4ktIA0=$K4kEc1[$K4k1Key];$v=$K4ktIA0;$K4kA0=$quantity>=$v['num'];if($K4kA0)goto K4keWjgxau;goto K4kldMhxau;K4keWjgxau:goto K4keWjgxaq;goto K4kxat;K4kldMhxau:K4kxat:goto K4kldMhxaq;K4keWjgxaq:goto K4keWjgxal;goto K4kxap;K4kldMhxaq:K4kxap:goto K4kldMhxal;K4keWjgxal:unset($K4ktIA0);$K4ktIA0=$v['price'];$price=$K4ktIA0;goto K4kxao;goto K4kxak;K4kldMhxal:K4kxak:K4kxan:$K4k1i=$K4k1i+1;goto K4kxam;goto K4kxar;K4kldMhxas:K4kxar:K4kxao:return $price;}public function pay_result(){unset($K4ktIA0);$K4ktIA0=input('orderid/s','');$orderid=$K4ktIA0;$K4kA0=!$orderid;if($K4kA0)goto K4keWjgxaw;goto K4kldMhxaw;K4keWjgxaw:$K4kzA1=array();$K4kzA1[]='Áº∫Â∞ëÂèÇÊï∞';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="error";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);goto K4kxav;K4kldMhxaw:K4kxav:$K4kzAvP0=array();$K4kzAvP0['trade_no']=$orderid;unset($K4ktIA0);$K4ktIA0=Db::name('order')->where($K4kzAvP0)->find();$orderInfo=$K4ktIA0;if(empty($orderInfo))goto K4keWjgxay;goto K4kldMhxay;K4keWjgxay:$K4kzA1=array();$K4kzA1[]='ËÆ¢Âçï‰∏çÂ≠òÂú®';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="error";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);goto K4kxax;K4kldMhxay:K4kxax:$K4kvPA0='/orderquery?orderid=' . $orderInfo['trade_no'];$K4kzA1=array();$K4kzA1[]=&$K4kvPA0;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="redirect";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return false;$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$orderInfo;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return view();}public function check_order_status(){unset($K4ktIA0);$K4ktIA0=input('out_trade_no/s','');$out_trade_no=$K4ktIA0;$K4kA0=!$out_trade_no;if($K4kA0)goto K4keWjgxb1;goto K4kldMhxb1;K4keWjgxb1:return J(1,'ÂèÇÊï∞ÈîôËØØÔºÅ');goto K4kxbz;K4kldMhxb1:K4kxbz:unset($K4ktIA0);$K4ktIA0=Db::table('order')->where('trade_no',$out_trade_no)->find();$order=$K4ktIA0;if(empty($order))goto K4keWjgxb3;goto K4kldMhxb3;K4keWjgxb3:return J(1,'ËÆ¢Âçï‰∏çÂ≠òÂú®ÔºÅ');goto K4kxb2;K4kldMhxb3:K4kxb2:$K4kA0=$order['status']==1;if($K4kA0)goto K4keWjgxb5;goto K4kldMhxb5;K4keWjgxb5:$K4kvPA0=url('/orderquery') . '?orderid=';$K4kvPA1=$K4kvPA0 . $out_trade_no;return J(0,'ÊîØ‰ªòÊàêÂäü',$K4kvPA1);goto K4kxb4;K4kldMhxb5:return J(1,'ËÆ¢ÂçïÁä∂ÊÄÅÊú™ÊîπÂèò');K4kxb4:}public function wxjspay(){unset($K4ktIA0);$K4ktIA0=input('trade_no/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgxb7;goto K4kldMhxb7;K4keWjgxb7:exit('‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ');goto K4kxb6;K4kldMhxb7:K4kxb6:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxb9;goto K4kldMhxb9;K4keWjgxb9:exit('ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ');goto K4kxb8;K4kldMhxb9:K4kxb8:unset($K4ktIA0);$K4ktIA0=$order->channel;$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgxbb;goto K4kldMhxbb;K4keWjgxbb:die('‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ');goto K4kxba;K4kldMhxbb:K4kxba:unset($K4ktIA0);$K4ktIA0=$order->channelAccount;$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxbd;goto K4kldMhxbd;K4keWjgxbd:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';die($K4kA1);goto K4kxbc;K4kldMhxbd:K4kxbc:$K4kzAvP1=array();$K4kzAvP1['id']=$order->channel_account_id;unset($K4ktIA0);$K4ktIA0=$channel->accounts()->where($K4kzAvP1)->find();$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxbf;goto K4kldMhxbf;K4keWjgxbf:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';return $K4kA1;goto K4kxbe;K4kldMhxbf:K4kxbe:$õ€å¿åƒ∆="strpos";$K4keF0=$õ€å¿åƒ∆($_SERVER['HTTP_USER_AGENT'],'MicroMessenger');$K4kA0=$K4keF0!==false;$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgxbi;goto K4kldMhxbi;K4keWjgxbi:$K4kA1=$channel->code=='UcyWxpay';$K4kA2=(bool)$K4kA1;goto K4kxbh;K4kldMhxbi:K4kxbh:if($K4kA2)goto K4keWjgxbj;goto K4kldMhxbj;K4keWjgxbj:$K4kA0=!session('openid');if($K4kA0)goto K4keWjgxbl;goto K4kldMhxbl;K4keWjgxbl:unset($K4ktIA0);$K4ktIA0=input('openid/s','');$openid=$K4ktIA0;$K4kA0=!$openid;if($K4kA0)goto K4keWjgxbn;goto K4kldMhxbn;K4keWjgxbn:unset($K4ktIA0);$K4ktIA0=$account->params->userid;$appid=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$account->params->mchid;$mchid=$K4ktIA0;$K4kvPvPA0=url('index/pay/wxjspay') . '?trade_no=';$K4kvPvPA1=$K4kvPvPA0 . $trade_no;$K4kzA2=array();$K4kzA2['appid']=$appid;$K4kzA2['mchid']=$mchid;$K4kzA2['redirect_url']=urlencode($K4kvPvPA1);unset($K4ktIA2);$K4ktIA2=$K4kzA2;$param=$K4ktIA2;unset($K4ktIA0);$K4ktIA0=$account->params->userkey;$key=$K4ktIA0;unset($K4ktIA0);$K4ktIA0='http://api.ucyzf.com/api/openid';$url=$K4ktIA0;ksort($param);unset($K4ktIA0);$K4ktIA0='';$sign=$K4ktIA0;unset($K4kEc1);$K4kEc1=array();foreach($param as $k=>$v){$K4kEc1[$k]=$v;};$K4k1i=0;K4kxbo:$œ∫¬…ÔÇï="count";$K4keF0=$œ∫¬…ÔÇï($K4kEc1);$K4kA0=$K4k1i<$K4keF0;if($K4kA0)goto K4keWjgxbs;goto K4kldMhxbs;K4keWjgxbs:unset($K4ktIA0);$K4ktIA0="array_keys";$É‹ö—ŒÇ£=$K4ktIA0;$K4keF0=$É‹ö—ŒÇ£($K4kEc1);unset($K4ktIA0);$K4ktIA0=$K4keF0;$k=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$k[$K4k1i];$k=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$K4kEc1[$k];$v=$K4ktIA0;$K4kA0=$k . '=';$K4kA1=$K4kA0 . $v;$K4kA2=$K4kA1 . '&';$K4kA0=$sign . $K4kA2;unset($K4ktIA1);$K4ktIA1=$K4kA0;unset($K4ktIA0);$K4ktIA0=$K4ktIA1;$sign=$K4ktIA0;$K4knWA3=$sign;K4kxbp:$K4k1i=$K4k1i+1;goto K4kxbo;goto K4kxbr;K4kldMhxbs:K4kxbr:K4kxbq:$ÈêÃ¿∏”í="trim";$K4keF0=$ÈêÃ¿∏”í($sign,'&');unset($K4ktIA0);$K4ktIA0=$K4keF0;$sign=$K4ktIA0;$K4kvPA0=$sign . $key;$‹√≤óéï∑="md5";$K4keF0=$‹√≤óéï∑($K4kvPA0);unset($K4ktIA1);$K4ktIA1=$K4keF0;$sign=$K4ktIA1;$K4kA0=$url . '?appid=';$K4kA1=$K4kA0 . $param['appid'];$K4kA2=$K4kA1 . '&redirect_url=';$K4kA3=$K4kA2 . $param['redirect_url'];$K4kA4=$K4kA3 . '&mchid=';$K4kA5=$K4kA4 . $param['mchid'];$K4kA6=$K4kA5 . '&sign=';$K4kA7=$K4kA6 . $sign;unset($K4ktIA8);$K4ktIA8=$K4kA7;$url=$K4ktIA8;$K4kvPA0='Location: ' . $url;$æì±˜–˘∏="header";$K4keF0=$æì±˜–˘∏($K4kvPA0);die();goto K4kxbm;K4kldMhxbn:session('openid',$openid);K4kxbm:goto K4kxbk;K4kldMhxbl:K4kxbk:goto K4kxbg;K4kldMhxbj:K4kxbg:unset($K4ktIA0);$K4ktIA0=session('token');$token=$K4ktIA0;$K4kA0=!$token;if($K4kA0)goto K4keWjgxbu;goto K4kldMhxbu;K4keWjgxbu:$ƒÊ„ò˜Û‹="time";$K4keFvP0=$ƒÊ„ò˜Û‹();$ËÔÔËÈñû="time";$K4keFvPvP1=$ËÔÔËÈñû();$¢õô˙ı∫="md5";$K4keFvP2=$¢õô˙ı∫($K4keFvPvP1);$K4kvPA0=$K4keFvP0 . $K4keFvP2;$»í∂∆±◊Ñ="time";$K4keFvP3=$»í∂∆±◊Ñ();$K4kvPA1=$K4kvPA0 . $K4keFvP3;$ùñé‘Î¯ñ="md5";$K4keF4=$ùñé‘Î¯ñ($K4kvPA1);$Ã˚á”Ñ¶Ω="time";$K4keF5=$Ã˚á”Ñ¶Ω();$K4kA2=$K4keF4 . $K4keF5;unset($K4ktIA3);$K4ktIA3=$K4kA2;$token=$K4ktIA3;session('token',$token);goto K4kxbt;K4kldMhxbu:K4kxbt:$K4kzA1=array();$K4kzA1[]='token';$K4kzA1[]=&$token;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('isMobile',$this->request->isMobile());$K4kzA1=array();$K4kzA1[]='channel';$K4kzA1[]=&$channel;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('wxjspay',$order->pay_content_type);unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kA0=sysconf('buy_notice')=='2';if($K4kA0)goto K4keWjgxbw;goto K4kldMhxbw;K4keWjgxbw:$K4kvPA0='' . sysconf('buy_notice_con');$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;goto K4kxbv;K4kldMhxbw:$K4kvPA0='ÂïÜÂìÅÂêçÁß∞Ôºö' . $order->goods_name;$K4kvPA1=$K4kvPA0 . ' ËÆ¢ÂçïÔºö';$K4kvPA2=$K4kvPA1 . $trade_no;unset($K4ktIA3);$K4ktIA3=$PayAPI->order($trade_no,$K4kvPA2,round($order->total_price,2));$res=$K4ktIA3;K4kxbv:$K4kA0=$res===false;if($K4kA0)goto K4keWjgxby;goto K4kldMhxby;K4keWjgxby:$K4kzA1=array();$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="getError";$K4khCvP0=call_user_func_array($K4kzA2,$K4kzA1);$this->assign('error',$K4khCvP0);$K4kzA1=array();$K4kzA1[]='order';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;goto K4kxbx;K4kldMhxby:K4kxbx:unset($K4ktIA0);$K4ktIA0=$res->pay_url;$order->pay_url=$K4ktIA0;if(isset($res->content_type))goto K4keWjgxc1;goto K4kldMhxc1;K4keWjgxc1:$K4kA0=$res->content_type;goto K4kxcz;K4kldMhxc1:$K4kA0=1;K4kxcz:unset($K4ktIA1);$K4ktIA1=$K4kA0;$order->pay_content_type=$K4ktIA1;$K4kzA1=array();$K4kzA1[]='order';$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);$K4kzA1=array();$K4kzA1[]='order';$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="fetch";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return $K4khC0;}public function wx_js_api_call(){unset($K4ktIA0);$K4ktIA0=input('code/s','');$code=$K4ktIA0;$K4kA0=!$code;if($K4kA0)goto K4keWjgxc3;goto K4kldMhxc3;K4keWjgxc3:exit('Áº∫Â∞ëcodeÂèÇÊï∞ÔºÅ');goto K4kxc2;K4kldMhxc3:K4kxc2:unset($K4ktIA0);$K4ktIA0=input('state/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgxc5;goto K4kldMhxc5;K4keWjgxc5:exit('‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ');goto K4kxc4;K4kldMhxc5:K4kxc4:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxc7;goto K4kldMhxc7;K4keWjgxc7:exit('ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ');goto K4kxc6;K4kldMhxc7:K4kxc6:unset($K4ktIA0);$K4ktIA0=$order->channel;$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgxc9;goto K4kldMhxc9;K4keWjgxc9:die('‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ');goto K4kxc8;K4kldMhxc9:K4kxc8:unset($K4ktIA0);$K4ktIA0=$order->channelAccount;$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxcb;goto K4kldMhxcb;K4keWjgxcb:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';die($K4kA1);goto K4kxca;K4kldMhxcb:K4kxca:unset($K4ktIA0);$K4ktIA0=PayAPI::load($channel,$account);$PayAPI=$K4ktIA0;$K4kzA1=array();$K4kzA1[]=&$code;$K4kzA1[]=&$order;$K4kzA2=array();$K4kzA2[]=$PayAPI;$K4kzA2[]="js_api_call";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);}public function wx_jspay_page(){unset($K4ktIA0);$K4ktIA0=input('url/s','');$pay_url=$K4ktIA0;$K4kA0=!$pay_url;if($K4kA0)goto K4keWjgxcd;goto K4kldMhxcd;K4keWjgxcd:exit('Áº∫Â∞ëÂèÇÊï∞');goto K4kxcc;K4kldMhxcd:K4kxcc:$Øä·º∏˝˙="base64_decode";$K4keFvP0=$Øä·º∏˝˙($pay_url);$K4kzA2=array();$K4kzA2[]='pay_url';$K4kzA2[]=&$K4keFvP0;$K4kzA3=array();$K4kzA3[]=$this;$K4kzA3[]="assign";$K4khC1=call_user_func_array($K4kzA3,$K4kzA2);unset($K4ktIA0);$K4ktIA0=input('trade_no/s','');$trade_no=$K4ktIA0;$K4kzA1=array();$K4kzA1[]='trade_no';$K4kzA1[]=&$trade_no;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);unset($K4ktIA0);$K4ktIA0=session('token');$token=$K4ktIA0;$K4kA0=!$token;if($K4kA0)goto K4keWjgxcf;goto K4kldMhxcf;K4keWjgxcf:$™·…·æÍı="time";$K4keFvP0=$™·…·æÍı();$ùÌﬂ¨Ÿ¥∏="time";$K4keFvPvP1=$ùÌﬂ¨Ÿ¥∏();$Ã§¯õ¶±•="md5";$K4keFvP2=$Ã§¯õ¶±•($K4keFvPvP1);$K4kvPA0=$K4keFvP0 . $K4keFvP2;$¬‘’æ˘∫ô="time";$K4keFvP3=$¬‘’æ˘∫ô();$K4kvPA1=$K4kvPA0 . $K4keFvP3;$æ«ñ‡Ò¢¿="md5";$K4keF4=$æ«ñ‡Ò¢¿($K4kvPA1);$Ãåﬂàû…Ø="time";$K4keF5=$Ãåﬂàû…Ø();$K4kA2=$K4keF4 . $K4keF5;unset($K4ktIA3);$K4ktIA3=$K4kA2;$token=$K4ktIA3;session('token',$token);goto K4kxce;K4kldMhxcf:K4kxce:$K4kzA1=array();$K4kzA1[]='token';$K4kzA1[]=&$token;$K4kzA2=array();$K4kzA2[]=$this;$K4kzA2[]="assign";$K4khC0=call_user_func_array($K4kzA2,$K4kzA1);return view();}public function submit_order_form(){unset($K4ktIA0);$K4ktIA0=input('trade_no/s','');$trade_no=$K4ktIA0;$K4kzAvP0=array();$K4kzAvP0['trade_no']=$trade_no;unset($K4ktIA0);$K4ktIA0=OrderModel::get($K4kzAvP0);$order=$K4ktIA0;$K4kA0=!$order;if($K4kA0)goto K4keWjgxch;goto K4kldMhxch;K4keWjgxch:exit('‰∏çÂ≠òÂú®ËØ•ËÆ¢ÂçïÔºÅ');goto K4kxcg;K4kldMhxch:K4kxcg:$K4kA0=$order->status==1;if($K4kA0)goto K4keWjgxcj;goto K4kldMhxcj;K4keWjgxcj:exit('ËØ•ËÆ¢ÂçïÂ∑≤ÂÆåÊàêÔºÅ');goto K4kxci;K4kldMhxcj:K4kxci:unset($K4ktIA0);$K4ktIA0=$order->channel;$channel=$K4ktIA0;$K4kA0=!$channel;if($K4kA0)goto K4keWjgxcl;goto K4kldMhxcl;K4keWjgxcl:die('‰∏çÂ≠òÂú®ËØ•ÊîØ‰ªòÊ∏†ÈÅìÔºÅ');goto K4kxck;K4kldMhxcl:K4kxck:unset($K4ktIA0);$K4ktIA0=$order->channelAccount;$account=$K4ktIA0;$K4kA0=!$account;if($K4kA0)goto K4keWjgxcn;goto K4kldMhxcn;K4keWjgxcn:$K4kA0='‰∏çÂ≠òÂú®ÊîØ‰ªòÊ∏†ÈÅìÔºö' . $channel->title;$K4kA1=$K4kA0 . 'ÁöÑË¥¶Âè∑ÔºÅ';die($K4kA1);goto K4kxcm;K4kldMhxcn:K4kxcm:$K4kA0=$order['pay_content_type']!=7;if($K4kA0)goto K4keWjgxcp;goto K4kldMhxcp;K4keWjgxcp:die('denied');goto K4kxco;K4kldMhxcp:K4kxco:echo $order['pay_url'];}public function notifyzf(){$K4kA0=!$_POST;if($K4kA0)goto K4keWjgxcr;goto K4kldMhxcr;K4keWjgxcr:exit('error');goto K4kxcq;K4kldMhxcr:K4kxcq:$¢“ΩΩ—œΩ="file_put_contents";$K4keF1=$¢“ΩΩ—œΩ("suc.txt",json_encode($_POST),FILE_APPEND);unset($K4ktIA0);$K4ktIA0=sysconf('payid');$userid=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=sysconf('paykey');$key=$K4ktIA0;$K4kzA0=array();$K4kzA0['title']=$_POST['title'];$K4kzA0['userid']=$userid;$K4kzA0['notify_url']=$_POST['notify_url'];$K4kzA0['return_url']=$_POST['return_url'];$K4kzA0['amount']=$_POST['amount'];$K4kzA0['orderno']=$_POST['orderno'];unset($K4ktIA0);$K4ktIA0=$K4kzA0;$param=$K4ktIA0;ksort($param);$K4kvPA0=http_build_query($param) . $key;$˜ô∫‰Ïì‚="md5";$K4keF1=$˜ô∫‰Ïì‚($K4kvPA0);unset($K4ktIA1);$K4ktIA1=$K4keF1;$sign=$K4ktIA1;$K4kA0=$sign==$_POST['sign'];$K4kA2=(bool)$K4kA0;if($K4kA2)goto K4keWjgxcu;goto K4kldMhxcu;K4keWjgxcu:$K4kA1=$_POST['errcode']==0;$K4kA2=(bool)$K4kA1;goto K4kxct;K4kldMhxcu:K4kxct:if($K4kA2)goto K4keWjgxcv;goto K4kldMhxcv;K4keWjgxcv:$K4kvPA0="orderid='" . $_POST['orderno'];$K4kvPA1=$K4kvPA0 . "'";unset($K4ktIA2);$K4ktIA2=Db::name('zt_order')->where($K4kvPA1)->find();$res=$K4ktIA2;$K4kA0=$res['status']==0;if($K4kA0)goto K4keWjgxcx;goto K4kldMhxcx;K4keWjgxcx:unset($K4ktIA0);$K4ktIA0=$res['id'];$data['id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=1;$data['status']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=$_POST['transaction'];$data['trade_no']=$K4ktIA0;$«Œ‹µîó="time";$K4keF0=$«Œ‹µîó();unset($K4ktIA0);$K4ktIA0=$K4keF0;$data['paytime']=$K4ktIA0;Db::name('zt_order')->update($data);unset($K4ktIA0);$K4ktIA0=$res['zdid'];$datachi['id']=$K4ktIA0;unset($K4ktIA0);$K4ktIA0=1;$datachi['istop']=$K4ktIA0;$≠¶ΩÀû√≤="time";$K4keF0=$≠¶ΩÀû√≤();$K4kA0=$res['moneyid']*60;$K4kA1=$K4kA0*60;$K4kA2=$K4keF0+$K4kA1;unset($K4ktIA3);$K4ktIA3=$K4kA2;$datachi['toptime']=$K4ktIA3;unset($K4ktIA0);$K4ktIA0=$res['moneyid'];$datachi['zdtime']=$K4ktIA0;Db::name('goods_chi')->update($datachi);goto K4kxcw;K4kldMhxcx:K4kxcw:ob_clean();echo 'ok';goto K4kxcs;K4kldMhxcv:echo 'fail sign';K4kxcs:}}
?>